!function(e){function t(n){if(o[n])return o[n].exports;var r=o[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){o(27),o(30),o(29),o(28),o(26),o(31),o(33),o(32),o(37),o(36),o(35),o(34),o(38),o(40),o(39),o(43),o(41),o(42)},,,,,,,,,,,,,,,,,,,,,,,,,,function(){"use strict";angular.module("qibud.common").factory("api",["$rootScope","$http","$window",function(e,t,o){function n(){var e=$.Callbacks();return{subscribe:function(t,o){o?t.$on("$destroy",function(){e.remove(o)}):o=t,e.add(o)},unsubscribe:e.remove,publish:e.fire}}function r(e,t){return e[t]}var u="api",s=o.sessionStorage.token||o.localStorage.token,d={Authorization:"Bearer "+s},i=(o.document.location.origin||o.location.protocol+"//"+o.location.host).replace(/^http/,"ws"),c={events:{}},a=c.ws=new WebSocket(i+"?access_token="+s);return o.setInterval(function(){a.send("ping")},25e3),c.connected=n(),a.onopen=function(){c.connected.publish.apply(this,arguments),e.$apply()},c.disconnected=n(),a.onclose=function(){c.disconnected.publish.apply(this,arguments),e.$apply()},c.buds={search:function(e){return t({method:"GET",url:u+"/buds/search/"+e,headers:d})},childrenByType:function(e,o){return t({method:"GET",url:u+"/buds/"+e+"/child/"+o,headers:d})},list:function(){return t({method:"GET",url:u+"/buds",headers:d})},view:function(e){return t({method:"GET",url:u+"/buds/"+e+"/view",headers:d})},update:function(e){return t({method:"PUT",url:u+"/buds/"+e.id+"/update",data:e,headers:d})},updated:n(),"delete":function(e){return t({method:"DELETE",url:u+"/buds/"+e,headers:d})},create:function(e){return t({method:"POST",url:u+"/buds",data:e,headers:d})},createSub:function(e,o){return t({method:"POST",url:u+"/buds/"+e,data:o,headers:d})},created:n(),evolve:function(e,o){return t({method:"PUT",url:u+"/buds/"+e.id+"/evolve/"+o,data:e,headers:d})},evolved:n(),follow:function(e){return t({method:"PUT",url:u+"/buds/"+e.id+"/follow",data:e,headers:d})},unfollow:function(e){return t({method:"PUT",url:u+"/buds/"+e.id+"/unfollow",data:e,headers:d})},followersChanged:n(),sponsor:function(e){return t({method:"PUT",url:u+"/buds/"+e.id+"/sponsor",data:e,headers:d})},unsponsor:function(e){return t({method:"PUT",url:u+"/buds/"+e.id+"/unsponsor",data:e,headers:d})},sponsorsChanged:n(),support:function(e,o){return t({method:"PUT",url:u+"/buds/"+e.id+"/support/"+o,data:e,headers:d})},unsupport:function(e){return t({method:"PUT",url:u+"/buds/"+e.id+"/unsupport",data:e,headers:d})},supportersChanged:n(),share:function(e,o){return t({method:"PUT",url:u+"/buds/"+e.id+"/share",data:o,headers:d})},budPacksData:{create:function(e,o,n){return t({method:"POST",url:u+"/buds/"+e+"/packdata/"+n,data:o,headers:d})},get:function(e,o){return t({method:"GET",url:u+"/buds/"+e+"/packdata/"+o,headers:d})},set:function(e,o,n){return t({method:"PUT",url:u+"/buds/"+e+"/packdata/"+n,data:o,headers:d})},created:n(),updated:n()},comments:{create:function(e,o){return t({method:"POST",url:u+"/buds/"+e+"/comments",data:o,headers:d})},created:n()}},c.qi={updated:n()},c.mailboxes={get:function(){return t({method:"GET",url:u+"/user/mailboxes/emails",headers:d})},incoming:n()},c.links={createB2B:function(e,o,n){return t({method:"POST",url:u+"/links/b2b/"+e+"/"+o+"/"+n,headers:d})},createB2U:function(e,o,n){return t({method:"POST",url:u+"/links/b2u/"+e+"/"+o+"/"+n,headers:d})},createU2B:function(e,o,n){return t({method:"POST",url:u+"/links/u2b/"+e+"/"+o+"/"+n,headers:d})},deleteU2B:function(e,o,n){return t({method:"DELETE",url:u+"/links/u2b/"+e+"/"+o+"/"+n,headers:d})},findU2B:function(e,o){return t({method:"GET",url:u+"/links/u2b/"+e+"/"+o,headers:d})}},c.users={list:function(){return t({method:"GET",url:u+"/users",headers:d})}},c.actors={list:function(){return t({method:"GET",url:u+"/actors",headers:d})}},c.events={list:function(){return t({method:"GET",url:u+"/events",headers:d})}},c.types={get:function(e){return t({method:"GET",url:u+"/types/"+e,headers:d})},list:function(){return t({method:"GET",url:u+"/types",headers:d})}},c.debug={clearDatabase:function(){return t({method:"POST",url:u+"/debug/clearDatabase",headers:d})}},a.onmessage=function(t){var o=JSON.parse(t.data);if(!o.method)throw"Malformed event data received through WebSocket. Received event data object was: "+o;if(!o.method.split(".").reduce(r,c))throw"Undefined event type received through WebSocket. Received event data object was: "+o;o.method.split(".").reduce(r,c).publish(o.params),e.$apply()},c}])},function(){"use strict";angular.module("qibud.common",["ui.bootstrap"])},function(){angular.module("qibud.common").controller("MailConverterCtrl",["$scope","$modalInstance","email",function(e,t,o){e.email=o,e.ok=function(){t.close(e.selectedUsers)},e.cancel=function(){t.dismiss("cancel")}}])},function(){angular.module("qibud.common").controller("MailboxCtrl",["$scope","$modal","api",function(e,t,o){e.emails={},o.mailboxes.get().success(function(t){e.emails=t}),e.openEmail=function(e){var o=t.open({templateUrl:"mail.html",controller:"MailConverterCtrl",size:"lg",resolve:{email:function(){return e}}});o.result.then(function(){},function(){})}}])},function(){angular.module("qibud.common").controller("SearchCtrl",["$scope","api",function(e,t){e.results={},e.search=function(o){o&&t.buds.search(o).success(function(t){t.hits&&(e.results=t.hits.total>0?t.hits.hits.map(function(e){return e}):{})})}}])},function(){function e(e,t){var o=992;e.getWidth=function(){return window.innerWidth},e.$watch(e.getWidth,function(n){e.toggle=n>=o?angular.isDefined(t.get("toggle"))&&0==t.get("toggle")?!1:!0:!1}),e.toggleSidebar=function(){e.toggle=!e.toggle,t.put("toggle",e.toggle)},window.onresize=function(){e.$apply()}}angular.module("qibud.dashboard",[]).controller("DashboardCtrl",["$scope","$cookieStore",e])},function(){"use strict";angular.module("qibud.editor").controller("EditorCtrl",["$scope","$state","$stateParams","$location","api",function(e,t,o,n,r){e.common.user;o.budId?r.buds.view(o.budId).success(function(t){e.editedBud=t,e.budBox={title:t.title,content:t.content,privacy:t.privacy,type:t.type,disabled:!1,action:"update"},e.setType(t.type)}):e.budBox={title:null,content:null,type:"Bud",disabled:!1,privacy:"Private",action:"create"},o.parentBudId&&(r.buds.view(o.parentBudId).success(function(t){e.parentBud=t}),e.budBox.action="subbud"),o.content&&(e.budBox.content=o.content),e.editorOptions={uiColor:"#000000"},e.setType=function(e){t.go("Bud"===e?"bud.editor":"bud.editor."+e)},e.createBud=function(o){return!e.budBox.content.length||e.budBox.disabled?void o.preventDefault():(e.budBox.disabled=!0,void r.buds.create({title:e.budBox.title,content:e.budBox.content,privacy:e.budBox.privacy,type:e.budBox.type}).success(function(o){e.budBox.title="",e.budBox.content="",e.budBox.disabled=!1,t.go("bud.viewer",{budId:o},{reload:!0})}).error(function(){e.budBox.disabled=!1}))},e.createSubBud=function(o){return!e.budBox.content.length||e.budBox.disabled?void o.preventDefault():(e.budBox.disabled=!0,void r.buds.createSub(e.parentBud.id,{title:e.budBox.title,content:e.budBox.content,privacy:e.budBox.privacy,type:e.budBox.type}).success(function(o){e.budBox.title="",e.budBox.content="",e.budBox.disabled=!1,t.go("bud.viewer",{budId:o})}).error(function(){e.budBox.disabled=!1}))},e.updateBud=function(o){return!e.budBox.content.length||e.budBox.disabled?void o.preventDefault():(e.budBox.disabled=!0,e.editedBud.title=e.budBox.title,e.editedBud.content=e.budBox.content,e.editedBud.privacy=e.budBox.privacy,e.editedBud.type="Bud"===e.budBox.type?"":e.budBox.type,void r.buds.update(e.editedBud).success(function(){t.go("bud.viewer",{budId:e.editedBud.id},{reload:!0})}).error(function(){e.budBox.disabled=!1}))},r.buds.created.subscribe(e,function(){})}])},function(){"use strict";angular.module("qibud.editor",["ui.router","qibud.common"]).config(["$stateProvider","$urlRouterProvider",function(e){e.state("bud.editor",{title:"Qibud Editor",url:"/editor/:budId/:parentBudId/:content",breadcrumb:{"class":"highlight",text:"Bud Editor",stateName:"bud.editor"},templateUrl:"modules/editor/editor.html",controller:"EditorCtrl"})}])},function(){"use strict";angular.module("qibud.home").controller("BudgraphCtrl",["$scope","$state","api","budGraph",function(e,t,o,n){var r,u=(e.common.user,{});o.buds.list().success(function(t){e.buds=t;for(var s=0;s<e.buds.length;s++){var d=e.buds[s];u[d.id]=d}t.forEach(function(e){"Bud"!==e.type&&o.buds.budPacksData.get(e.id,e.type).success(function(t){e.state=t.state})}),n(e.buds).then(function(t){r=t,e.cyLoaded=!0})}),e.onWeightChange=function(e){n.setBudWeight(e.id,e.qi)},n.onWeightChange(function(t,o){u[t].qi=o,e.$apply()}),n.onClick(function(e){t.go("bud.viewer",{budId:e})}),o.buds.created.subscribe(e,function(t){_.some(e.buds,function(e){return e.id===t.id})||(t.comments=[],t.commentBox={message:"",disabled:!1},e.buds.unshift(t))})}])},function(){"use strict";angular.module("qibud.home").factory("budGraph",["$q",function(e){function t(e,t){for(var o=r.listeners[e],n=0;o&&n<o.length;n++){var u=o[n];u.apply(u,t)}}function o(e,t){var o=r.listeners[e]=r.listeners[e]||[];o.push(t)}var n,r=function(o){for(var r=e.defer(),u=[],s=0;s<o.length;s++)u.push({group:"nodes",data:{id:o[s].id,weight:20,label:o[s].type,name:"["+o[s].type+"]"+o[s].title,faveColor:"#30426a",faveShape:"Team"==o[s].type?"octagon":"roundrectangle"}});for(var s=0;s<o.length;s++)if(o[s].subBuds)for(var d=0;d<o[s].subBuds.length;d++)u.push({group:"edges",data:{source:o[s].id,target:o[s].subBuds[d].id,faveColor:"#30426a",strength:1}});return $(function(){n=cytoscape({container:$("#cy")[0],style:cytoscape.stylesheet().selector("node").css({shape:"data(faveShape)",width:"mapData(weight, 10, 10, 10, 10)",content:"data(name)","text-valign":"center","text-outline-width":2,"background-color":"data(faveColor)",color:"#fff","box-shadow":"0 10px 18px rgba(0,0,0,.22),0 14px 45px rgba(0,0,0,.25)"}).selector(":selected").css({"border-width":3,"border-color":"#333"}).selector("edge").css({opacity:.666,width:"mapData(strength, 35, 50, 2, 6)","target-arrow-shape":"triangle","source-arrow-shape":"circle","line-color":"data(faveColor)","source-arrow-color":"data(faveColor)","target-arrow-color":"data(faveColor)"}).selector(".faded").css({opacity:.25,"text-opacity":0}),layout:{name:"cose",padding:10},elements:u,ready:function(){r.resolve(this),n.on("cxtdrag","node",function(e){var o=this,n=Math.abs(e.cyPosition.x-o.position().x),r=Math.round(2*n);o.data("weight",r),t("onWeightChange",[o.id(),o.data("weight")])}),n.on("tap","node",function(){var e=this;t("onClick",[e.id()])})}})}),r.promise};return r.listeners={},r.setBudWeight=function(e,t){n.$("#"+e).data("weight",t)},r.onWeightChange=function(e){o("onWeightChange",e)},r.onClick=function(e){o("onClick",e)},r}])},function(){"use strict";angular.module("qibud.home").controller("HomeCtrl",["$scope","$state","api","budGraph",function(e,t,o){var n=e.common.user;o.buds.list().success(function(t){t.forEach(function(e){(e.type||"Bud"!==e.type)&&o.types.get(e.type).success(function(t){e.typeInfo=t}),e.commentBox={message:"",disabled:!1},e.comments=e.comments||[]}),e.buds=t,o.links.findU2B(n.id,"ACTOR").success(function(t){t.forEach(function(t){_.remove(e.buds,function(e){return e.id===t._id}),(t.type||"Bud"!==t.type)&&o.types.get(t.type).success(function(e){t.typeInfo=e}),t.commentBox={message:"",disabled:!1},t.comments=t.comments||[]}),e.budsActingOn=t})}),o.buds.created.subscribe(e,function(t){_.some(e.buds,function(e){return e.id===t.id})||(t.comments=[],t.commentBox={message:"",disabled:!1},e.buds.unshift(t))}),o.buds.comments.created.subscribe(e,function(t){var o=_.find(e.buds,function(e){return e.id===t.budId});o&&!_.some(o.comments,function(e){return e.id===t.id})&&o.comments.push(t)})}])},function(){"use strict";angular.module("qibud.home",["ui.router","qibud.common"]).config(["$stateProvider","$urlRouterProvider",function(e){e.state("home.stickers",{title:"Dashboard",breadcrumb:{"class":"highlight",text:"Bud stickers",stateName:"bud.home.stickers"},url:"/stickers",templateUrl:"modules/home/home-stickers.html",controller:"HomeCtrl"}).state("home.budgraph",{title:"Bud Graph",breadcrumb:{"class":"highlight",text:"Bud Graph",stateName:"bud.home.budgraph"},url:"/graph",templateUrl:"modules/home/home-budgraph.html",controller:"BudgraphCtrl"}).state("home.timeline",{title:"Bud Timeline",breadcrumb:{"class":"highlight",text:"Bud Timeline",stateName:"bud.home.timeline"},url:"/timeline",templateUrl:"modules/home/home-timeline.html",controller:"TimelineCtrl"})}])},function(){"use strict";angular.module("qibud.home").controller("TimelineCtrl",["$scope","$state","api","budGraph",function(e,t,o){e.common.user;o.events.list().success(function(t){e.events=t})}])},function(){"use strict";angular.module("qibud.profile").controller("ProfileCtrl",["$scope",function(e){e.user=e.common.user}])},function(){"use strict";angular.module("qibud.profile",["ui.router","qibud.common"]).config(["$stateProvider","$urlRouterProvider",function(e){e.state("bud.profile",{url:"/profile",title:"User Profile",breadcrumb:{"class":"highlight",text:"User Profile",stateName:"bud.profile"},templateUrl:"modules/profile/profile.html",controller:"ProfileCtrl"})}])},function(){"use strict";angular.module("qibud.viewer").controller("ViewerCtrl",["$scope","$state","$stateParams","$modal","api",function(e,t,o,n,r){var u=e.common.user;e.typeInfo=null,e.ready=!1,e.actionInProgress=!1,e.followersCount=0,e.sponsorsCount=0,e.supportersCount=0,e.supportValue=0,e.load=function(){e.ready=!1,r.buds.view(o.budId).success(function(t){t.commentBox={message:"",disabled:!1},t.comments=t.comments||[],e.bud=t,e.showType(e.bud.type,!1),t.followers?(e.followersCount=t.followers.length,e.follower=-1!==t.followers.indexOf(u.id)?!0:!1):e.follower=!1,t.sponsors?(e.sponsorsCount=t.sponsors.length,e.sponsorer=-1!==t.sponsors.indexOf(u.id)?!0:!1):e.sponsorer=!1,t.supporters?(e.supportersCount=t.supporters.length,e.supporter=-1!==t.supporters.indexOf(u.id)?!0:!1):e.supporter=!1,e.ready=!0})},e.load(),e.showType=function(o,n){"Bud"!==o?(r.types.get(o).success(function(t){e.typeInfo=t}),t.go("bud.viewer."+o,t.params,{reload:n})):t.go("bud.viewer",t.params,{reload:n})},e.evolve=function(t,o){return e.actionInProgress?void t.preventDefault():(e.actionInProgress=!0,void r.buds.evolve(e.bud,o).success(function(){e.actionInProgress=!1}).error(function(){e.actionInProgress=!1}))},e.canEvolve=function(){return e.bud&&"Bud"===e.bud.type&&e.bud.creator.id===u.id?!0:!1},e.editSubBud=function(){t.go("bud.editor",{parentBud:e.bud})},e.budify=function(o){t.go("bud.editor",{parentBud:e.bud,content:o})},e["delete"]=function(){r.buds["delete"](e.bud.id).success(function(){t.go("home.stickers")})},e.share=function(){r.actors.list().success(function(t){var o=n.open({templateUrl:"sharebox.html",controller:"ShareboxCtrl",size:"lg",resolve:{users:function(){return t.users},teams:function(){return t.teams}}});o.result.then(function(t){r.buds.share(e.bud,t).success(function(){})},function(){})})},e.canShare=function(){var t=!1;if(!e.bud)return t;var o=e.bud.creator.id;switch(e.bud.privacy){case"Private":o===u.id&&(t=!0);break;case"Private2Share":o===u.id&&(t=!0);break;case"Free2Share":t=!0}return t},e.followBud=function(t){return e.actionInProgress?void t.preventDefault():(e.actionInProgress=!0,void(e.follower?r.buds.unfollow(e.bud).success(function(){e.actionInProgress=!1}).error(function(){e.actionInProgress=!1}):r.buds.follow(e.bud).success(function(){e.actionInProgress=!1}).error(function(){e.actionInProgress=!1})))},e.supportBud=function(t){return e.actionInProgress?void t.preventDefault():(e.actionInProgress=!0,void(e.supporter?r.buds.unsupport(e.bud).success(function(){e.actionInProgress=!1}).error(function(){e.actionInProgress=!1}):r.buds.support(e.bud,e.supportValue).success(function(){e.actionInProgress=!1}).error(function(){e.actionInProgress=!1})))},e.sponsorBud=function(t){return e.actionInProgress?void t.preventDefault():(e.actionInProgress=!0,void(e.sponsorer?r.buds.unsponsor(e.bud).success(function(){e.actionInProgress=!1}).error(function(){e.actionInProgress=!1}):r.buds.sponsor(e.bud).success(function(){e.actionInProgress=!1}).error(function(){e.actionInProgress=!1})))},r.buds.followersChanged.subscribe(e,function(t){e.bud.id===t.id&&(e.bud.followers=t.followers,e.followersCount=t.followers.length,e.follower=-1!==t.followers.indexOf(u.id)?!0:!1)}),r.buds.supportersChanged.subscribe(e,function(t){e.bud.id===t.id&&(e.bud.supporters=t.supporters,e.supportersCount=t.supporters.length,e.supporter=-1!==t.supporters.indexOf(u.id)?!0:!1)}),r.buds.sponsorsChanged.subscribe(e,function(t){e.bud.id===t.id&&(e.bud.sponsors=t.sponsors,e.sponsorsCount=t.sponsors.length,e.sponsorer=-1!==t.sponsors.indexOf(u.id)?!0:!1)}),e.createComment=function(e,t){if(13===e.keyCode){if(!t.commentBox.message.length||t.commentBox.disabled)return void e.preventDefault();t.commentBox.disabled=!0,r.buds.comments.create(t.id,{message:t.commentBox.message}).success(function(e){_.some(t.comments,function(t){return t.id===e})||t.comments.push({id:e,from:u,message:t.commentBox.message,createdTime:new Date}),t.commentBox.message="",t.commentBox.disabled=!1}).error(function(){t.commentBox.disabled=!1}),e.preventDefault()}},r.buds.comments.created.subscribe(e,function(t){e.bud&&!_.some(e.bud.comments,function(e){return e.id===t.id})&&e.bud.comments.push(t)}),r.buds.updated.subscribe(e,function(t){e.bud.id===t.id&&(e.bud=t)}),r.buds.evolved.subscribe(e,function(t){e.bud.id===t.id&&e.showType(t.type,!0)}),r.qi.updated.subscribe(e,function(t){e.bud.id===t.id&&(e.bud.qi=t.qi)})}])},function(){"use strict";angular.module("qibud.viewer").controller("ShareboxCtrl",["$scope","$modalInstance","users","teams",function(e,t,o,n){e.users=o,e.teams=n,e.selectedUsers=[],e.addUser=function(t){e.selectedUsers.push(t),_.remove(e.users,function(e){return e.id===t.id})},e.addTeam=function(t){angular.forEach(t.members,function(t){e.selectedUsers.push(t),_.remove(e.users,function(e){return e.id===t.id})})},e.rmUser=function(t){e.users.push(t),_.remove(e.selectedUsers,function(e){return e.id===t.id})},e.ok=function(){t.close(e.selectedUsers)},e.cancel=function(){t.dismiss("cancel")}}])},function(){"use strict";angular.module("qibud.viewer",["ui.router","ui.bootstrap","qibud.common"]).config(["$stateProvider","$urlRouterProvider",function(e){var t=[],o={};o["@"]={controller:"ViewerCtrl",templateUrl:"modules/viewer/viewer.html"},t.push({name:"bud.viewer",sticky:!0,url:"/viewer/:budId",views:o,breadcrumb:{"class":"highlight",text:"Bud Viewer",stateName:"bud.viewer"}}),angular.forEach(t,function(t){e.state(t)})}])}]);